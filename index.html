<script>
  const map = L.map('map').setView([12.9716, 77.5946], 13);

  // Base layer
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://carto.com/">CARTO</a> | &copy; OpenStreetMap contributors',
    subdomains: 'abcd',
    maxZoom: 19
  }).addTo(map);

  // Load Gulmohar.geojson
  fetch("https://raw.githubusercontent.com/mappingsomething/Gulmohar/main/Gulmohar.geojson")
    .then(res => res.json())
    .then(data => {
      L.geoJSON(data, {
        pointToLayer: function (feature, latlng) {
          return L.circleMarker(latlng, {
            radius: 6,
            fillColor: "#F7B7BB",
            color: "#fff",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
          });
        },
        onEachFeature: function (feature, layer) {
          const props = feature.properties;
          if (props["image_emd"] && props["timestamp"]) {
            const popupContent = `
              <div style="max-width: 350px;">
                <b>Spotted:</b> ${props["timestamp"]}<br>
                <img src="${props["image_emd"]}" alt="Tree image" 
                     style="width: 100%; border-radius: 8px; margin-top: 6px;"
                     onerror="this.style.display='none'" />
              </div>
            `;
            layer.bindPopup(popupContent, { maxWidth: 400 });
          }
        }
      }).addTo(map);
    });

  // Load GulmoharBBMP.geojson
  fetch("https://raw.githubusercontent.com/mappingsomething/Gulmohar/main/GulmoharBBMP.geojson")
    .then(res => res.json())
    .then(data => {
      L.geoJSON(data, {
        pointToLayer: function (feature, latlng) {
          return L.circleMarker(latlng, {
            radius: 6,
            fillColor: "#FF686B",
            color: "#fff",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.7
          });
        },
        onEachFeature: function (feature, layer) {
          const props = feature.properties;
          const popupContent = `
            <div style="max-width: 350px;">
              <b>Tree ID:</b> ${props["KGISTreeID"] || "Unknown"}<br>
              <b>Ward:</b> ${props["ward"] || "NA"}
            </div>
          `;
          layer.bindPopup(popupContent, { maxWidth: 400 });
        }
      }).addTo(map);
    });
</script>
